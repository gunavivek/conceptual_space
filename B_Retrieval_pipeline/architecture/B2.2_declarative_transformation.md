# B2.2: Declarative Transformation - Architecture Design

## Name
**B2.2: Declarative Transformation**

## Purpose
Transforms questions into declarative forms for better concept matching by converting interrogative structures into statement patterns that align more naturally with document content and concept vocabularies.

## Input File
- **Primary**: `outputs/B2_1_intent_layer_output.json`
- **Fallback**: `outputs/B1_current_question.json`
- **Contains**: Questions with intent analysis for transformation processing

## Output Files
- **Primary**: `outputs/B2_2_declarative_transformation_output.json`
- **Contains**: Declarative transformations with quality scores and key component extraction

## Processing Logic

### Pattern-Based Transformation Framework
- Implements **rule-based transformation patterns** for common question structures (What/How/When/Where/Why/Which/Who)
- Applies **domain-specific financial transformations** for change, increase, decrease patterns
- Generates **multiple declarative alternatives** for each question to maximize matching opportunities
- Creates **generic fallback transformations** when specific patterns don't match

### Quality Assessment System
- Measures **word preservation score** comparing original and transformed vocabularies while excluding question words
- Calculates **length similarity ratio** between original and declarative forms for structural consistency
- Applies **grammatical structure bonus** for presence of linking verbs (is, was, are, were)
- Combines metrics using weighted formula: Preservation (50%) + Length similarity (30%) + Structure (20%)

### Key Component Extraction
- Identifies **subjects** from first few words of declarative forms using positional heuristics
- Extracts **predicates** by matching common verb patterns (is, was, changed, occurred)
- Captures **temporal modifiers** through regex patterns for dates, years, and quarters
- Maintains **component uniqueness** by deduplicating across multiple declarative forms

### Transformation Ranking
- Ranks **declarative alternatives** by calculated quality scores in descending order
- Selects **best declarative** as highest-scoring transformation for primary matching
- Calculates **transformation confidence** using best quality score as reliability indicator
- Preserves **all alternatives** for downstream matching flexibility

## Key Decisions

### Transformation Pattern Selection
- **Decision**: Use manually crafted regex patterns rather than ML-based transformation
- **Rationale**: Ensures predictable and interpretable transformations with domain-specific customization
- **Impact**: Provides reliable pattern matching but requires maintenance for new question types

### Quality Weighting Schema
- **Decision**: Emphasize word preservation (50%) over structural factors (30% + 20%)
- **Rationale**: Prioritizes semantic content preservation while maintaining grammatical quality
- **Impact**: Favors transformations that retain original meaning over stylistic improvements

### Multiple Alternative Strategy
- **Decision**: Generate and preserve multiple declarative forms rather than selecting single best
- **Rationale**: Maximizes matching opportunities across different concept vocabulary patterns
- **Impact**: Increases downstream matching flexibility but requires handling multiple alternatives

### Component Extraction Scope
- **Decision**: Use simple heuristic-based extraction rather than sophisticated NLP parsing
- **Rationale**: Maintains processing efficiency while capturing essential semantic components
- **Impact**: Provides adequate component identification but may miss complex syntactic relationships

### Financial Domain Specialization
- **Decision**: Include specific transformation patterns for financial change questions
- **Rationale**: Addresses common financial document question patterns with specialized handling
- **Impact**: Improves financial domain performance but creates domain-specific processing paths

### Fallback Transformation Approach
- **Decision**: Generate generic declarative form when specific patterns fail to match
- **Rationale**: Ensures all questions receive some transformation rather than failing completely
- **Impact**: Provides processing robustness but may produce lower-quality transformations for unusual questions