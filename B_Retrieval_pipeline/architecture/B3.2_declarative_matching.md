# B3.2: Declarative Matching Strategy - Architecture Design

## Name
**B3.2: Declarative Matching Strategy**

## Purpose
Matches declarative forms of questions to concept patterns using structural analysis and pattern recognition to leverage the statement-like nature of declarative forms for improved concept-content alignment.

## Input Files
- **Primary**: `outputs/B2_2_declarative_transformation_output.json`
- **Secondary**: `../A_concept_pipeline/outputs/A2.5_expanded_concepts.json`
- **Fallback**: `../A_concept_pipeline/outputs/A2.4_core_concepts.json`
- **Contains**: Declarative transformations and expanded concept vocabularies

## Output Files
- **Primary**: `outputs/B3_2_declarative_matching_output.json`
- **Contains**: Declarative-based concept matches with pattern analysis and component alignment

## Processing Logic

### Declarative Similarity Assessment
- Calculates **word overlap scores** using intersection-over-union between declarative text words and concept keywords
- Applies **pattern-based scoring bonuses** for domain-specific patterns (financial: 0.3 bonus, general: 0.2 bonus)
- Integrates **declarative quality weighting** using transformation confidence scores from B2.2
- Combines metrics using formula: Word overlap (60%) + Pattern bonus + Quality weight (20%)

### Pattern Recognition Framework
- Implements **financial domain patterns** for revenue/income statements, change expressions, and cost/expense declarations
- Includes **general declarative patterns** for basic subject-predicate structures and occurrence statements
- Extracts **declarative components** (subjects, predicates, objects) using regex-based parsing
- Maps **component alignment** between declarative structures and concept vocabularies

### Component-Based Alignment
- Identifies **subject matches** between declarative subjects and concept keyword vocabularies
- Evaluates **predicate relevance** by checking presence of action/state verbs in declarative forms
- Assesses **object alignment** between declarative objects and concept terminologies
- Generates **component alignment metrics** for structural matching quality assessment

### Quality Integration Analysis
- Incorporates **transformation confidence scores** from B2.2 to weight declarative quality
- Combines **top similarity scores** with **transformation quality** for overall match assessment
- Evaluates **declarative form diversity** by analyzing multiple alternative transformations
- Calculates **overall confidence** balancing similarity strength with transformation reliability

## Key Decisions

### Similarity Calculation Weighting
- **Decision**: Emphasize word overlap (60%) over pattern bonuses and quality weighting (40% combined)
- **Rationale**: Prioritizes semantic content similarity while incorporating structural and quality factors
- **Impact**: Focuses on vocabulary alignment but may underweight important structural patterns

### Pattern Bonus Application
- **Decision**: Apply domain-specific pattern bonuses (financial 0.3, general 0.2) rather than uniform weighting
- **Rationale**: Recognizes that financial domain has more structured declarative patterns than general text
- **Impact**: Improves financial domain matching but creates domain-dependent processing behavior

### Component Extraction Strategy
- **Decision**: Use simple regex-based component extraction rather than sophisticated syntactic parsing
- **Rationale**: Maintains processing efficiency while capturing essential semantic components
- **Impact**: Provides adequate component identification but may miss complex grammatical relationships

### Multiple Declarative Handling
- **Decision**: Evaluate all declarative forms and select best-performing match rather than aggregating
- **Rationale**: Maximizes matching opportunities while avoiding dilution from lower-quality transformations
- **Impact**: Leverages transformation diversity but may not capture consensus across alternatives

### Quality Confidence Integration
- **Decision**: Combine transformation confidence with similarity scores for overall matching confidence
- **Rationale**: Acknowledges that poor declarative transformations reduce matching reliability
- **Impact**: Provides more nuanced confidence assessment but adds complexity to confidence interpretation

### Result Threshold Strategy
- **Decision**: Use minimum similarity threshold (0.1) with quality-based ranking rather than strict cutoffs
- **Rationale**: Captures potentially valid weak relationships while relying on quality metrics for filtering
- **Impact**: Maximizes matching recall but requires downstream quality assessment for final selection